name: Debug CI with upterm
on: [workflow_dispatch]
jobs:
  explore:
    runs-on: gpu
    defaults:
      run:
        shell: bash
    steps:
    - uses: prefix-dev/setup-pixi@v0.8.1
      with:
        pixi-version: v0.41.3
        log-level: v
        # cache: true
      continue-on-error: true
    - uses: actions/checkout@v4
    - name: Install nvhpc
      run: |
        source .github/workflows/install_nvhpc.sh
      continue-on-error: true
    - name: Install and test SlaterGPU
      run: |
        source ~/.pixi/envs/environment-modules/init/bash
        module load ~/work/modulefiles/nvhpc/25.1
        module list
        pixi install
        pixi run test-in-gh-action
      continue-on-error: true
    - name: Setup upterm session 
      uses: owenthereal/action-upterm@v1
      with:
        limit-access-to-actor: true
